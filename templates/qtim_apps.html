<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CU Applications Reverse Proxy</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      background: #f7f7f7;
      color: #333;
    }
    header {
      background: #cfb87c;
      padding: 20px;
      text-align: center;
      color: #000;
      font-size: 28px;
      font-weight: bold;
      border-bottom: 4px solid #000;
    }
    .container {
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
    }
    h2 {
      margin-top: 0;
    }
    .apps {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #ddd;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
    }
    .card h3 {
      margin-top: 0;
      font-size: 20px;
      color: #1a1a1a;
    }
    .card a {
      display: inline-block;
      margin-top: 10px;
      padding: 8px 14px;
      background: #cfb87c;
      color: #000;
      text-decoration: none;
      border-radius: 6px;
      font-weight: bold;
      border: 1px solid #000;
      transition: background 0.2s;
    }
    .card a:hover {
      background: #e5d6a0;
    }
    .card-disabled {
      background: white;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #ddd;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
    }
    .card-disabled h3 {
      margin-top: 0;
      font-size: 20px;
      color: #1a1a1a;
    }
    .card-disabled a {
      display: inline-block;
      margin-top: 10px;
      padding: 8px 14px;
      background: #cf7c9a;
      color: #000;
      text-decoration: none;
      border-radius: 6px;
      font-weight: bold;
      border: 1px solid #000;
      transition: background 0.2s;
    }
    .card-disabled a:hover {
      background: #e5d6a0;
    }
    footer {
      text-align: center;
      padding: 20px;
      font-size: 14px;
      color: #666;
      margin-top: 40px;
    }
  </style>
</head>

<body>
  <header>QTIM CU Applications Gateway</header>

  <div class="container">
    <h2>Welcome {{ samlNameId }}</h2>
    <h3>Select an application to continue:</h3>

    <div class="apps">

  </div>

  <footer>
    University of Colorado
  </footer>
</body>

<script type="text/javascript">
  apps = {{ apps_and_users | tojson }};
  samlNameId = {{ samlNameId | tojson }};
  function userInApp(app){
    return apps[app]['users'].includes(samlNameId) ? true : false
  }
  // Need a list of apps to show based on user

  filtered_items = Object.keys(apps).filter(userInApp)

  // Dynamically add an app card if user has access
  Object.keys(apps).forEach(function(app) {
    debugger
    if (userInApp(app)) {
      console.log(`User has access to ${app}`);
      // Here you can create and append the app card dynamically
      const app_div = document.createElement('div');
      app_div.className = 'card';
      const header3 = document.createElement('h3');
      header3.textContent = apps[app]['display_name'];
      const a_tag = document.createElement('a');
      a_tag.href = `/${app}`;
      a_tag.textContent = "Go to App";
      const p_tag_location = document.createElement('p');
      p_tag_location.textContent = `Location: ${apps[app]['location']}`;
      app_div.appendChild(header3);
      app_div.appendChild(a_tag);
      app_div.appendChild(p_tag_location);
      document.querySelector('.apps').appendChild(app_div);
    }
  });
  

</script>

</html>